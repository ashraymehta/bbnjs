# ajax.js

## Routing and Navigation.

These functions are meant to be used in a configured BBN environment,
i.e. a single page application where callback functions are already defined
and bbn has been initiated through bbn.fn.init.


<a name="bbn_top"></a>[abort](#abort)  
[ajax](#ajax)  
[callback](#callback)  
[download](#download)  
[downloadContent](#downloadContent)  
[getIdURL](#getIdURL)  
[getLoader](#getLoader)  
[link](#link)  
[post](#post)  
[setNavigationVars](#setNavigationVars)  
[treat_vars](#treat_vars)  
[upload](#upload)  
[window](#window)  


- <a name="ajax"></a>**bbn.fn.ajax(url, datatype, data, success, failure, abort)** [Back to top](#bbn_top)

  __Creates an XHR object and returns the Promise.__

  Checks the URL, makes an ID, creates a loader, sets the general callbacks,
makes a POST if data is given a GET otherwise (GET data should be added
directly in the URL), and returns the Promise.

  * __url__ _String_ The URL to be requested by XHR
  * __datatype__ _String_ The type of data expected
  * __data__ _Object_ The data (sent th)
  * __success__ _Function_ 
  * __failure__ _Function_ 
  * __abort__ _Function_ 

  __Returns__ _Promise_ The Promise created by the generated XHR.


```javascript
// Promise
bbn.fn.ajax(
  'my/location',
  'json',
  {id: 7},
  d => {
    console.log(d);
    alert("Success!");
  },
  err => {
    console.log(err);
    alert("Failure!");
  },
  () => {
    alert("Request aborted!");
  }
)
```


```javascript
// Promise
bbn.fn.ajax('my/location')
  .then(
    d => {
      console.log(d);
      alert("Success!");
    }
  )
  .catch(
    err => {
    }
  )
```

- <a name="treat_vars"></a>**bbn.fn.treat_vars(args)** [Back to top](#bbn_top)

  __Transforms unordered arguments into a configuratiuon object for Ajax shortcut functions.__

  The final object will have the following arguments: url, obj, datatype, force, successFn,
errorFn, abortFn, e, and ele; The rules are:
* The first string found is the URL
* The second string found is the datatype
* The first function is successFn
* The second function is errorFn
* The third function is abortFn
* A boolean true is force
* An Event is e
* An HTML element is ele
*.

  * __args__ _Mixed_ 

  __Returns__ _Object_ The configuration object

- <a name="post"></a>**bbn.fn.post()** [Back to top](#bbn_top)

  __Creates a POST XHR through bbn.fn.ajax then launches bbn.fn.callback with the result.__

  URL is the only mandatory argument (see treat_vars for the arguments).


  __Returns__ _undefined|Promise_ 

- <a name="link"></a>**bbn.fn.link()** [Back to top](#bbn_top)

  __Follows a link by sending the corresponding Ajax request and executing bbn.fn.defaultPreLinkFunction.__

  Once bbn has been initiated this funciton will be triggered every time a link is clicked 
(see treat_vars for the arguments).


  __Returns__ _undefined_ 

- <a name="window"></a>**bbn.fn.window()** [Back to top](#bbn_top)


  __Returns__ _undefined_ 

- <a name="callback"></a>**bbn.fn.callback(url, res, fn, fn2, ele)** [Back to top](#bbn_top)

  __Executes a serie of predefined actions once a content has been loaded.__

  * __url__ _String_ 
  * __res__ _Object_ 
  * __fn__ _Function_ 
  * __fn2__ _Function_ 
  * __ele__ _HTMLElement_ 

  __Returns__ _undefined_ 

- <a name="setNavigationVars"></a>**bbn.fn.setNavigationVars(url, title, data, repl)** [Back to top](#bbn_top)

  * __url__ _String_ 
  * __title__ _String_ 
  * __data__ _Object_ 
  * __repl__ _Boolean_ 

  __Returns__ _undefined_ 

- <a name="abort"></a>**bbn.fn.abort(idURL)** [Back to top](#bbn_top)

  __Aborts (client side) the XHR corresponding to the given ID if it still exists.__

  This will throw an error if the loader can't be found.

  * __idURL__ _String_ An ID generated by getIdURL

  __Returns__ _undefined_ 

- <a name="downloadContent"></a>**bbn.fn.downloadContent(filename, content, type)** [Back to top](#bbn_top)

  __Downloads a file with given filename from its content.__

  Creates a link putting in href a URL Object Blob made of the given content.

  * __filename__ _String_ 
  * __content__ _String_ 
  * __type__ _String_ 

  __Returns__ _undefined_ 

- <a name="download"></a>**bbn.fn.download(url, filename, params)** [Back to top](#bbn_top)

  __Downloads a file with given filename from a URL.__

  Gets the file's content as Blob through XHR, then sends it to bbn.fn.downloadContent.

  * __url__ _String_ 
  * __filename__ _String_ 
  * __params__ _Object_ 

  __Returns__ _undefined_ 

- <a name="upload"></a>**bbn.fn.upload(url, file, success, failure, progress)** [Back to top](#bbn_top)

  __Uploads a file synchronously through an XHR indicating progress.__

  * __url__ _String_ 
  * __file__ _File_ 
  * __success__ _Function_ 
  * __failure__ _Function_ 
  * __progress__ _Function_ 

  __Returns__ _Promise_ 

- <a name="getLoader"></a>**bbn.fn.getLoader(idURL)** [Back to top](#bbn_top)

  __Finds the loader corresponding to the given unique ID and returns it if found.__

  The loader is an object with the following properties:
* _loader_ is the Promise from the Axios XHR
*.

  * __idURL__ _String_ The unique ID of the request as used in bbn.env.loaders

  __Returns__ _false|Promise_ The corresponding Promise if it exists


```javascript

```

- <a name="getIdURL"></a>**bbn.fn.getIdURL(url, data, datatype)** [Back to top](#bbn_top)

  __Returns a unique ID for a "loader" based on the URL, the data keys and the datatype.__

  The routing functions don't allow to send the same request at the same moment,
therefore a unique ID is generated to identify them, based on the URL,
the keys of the data sent, and the expected returned data type.

  * __url__ _String_ 
  * __data__ _Object_ The data sent to the URL
  * __datatype__ _String_ The type of data requested (JSON by default)

  __Returns__ _String_ The unique ID


```javascript
// my/location:59990af62ba3ebdd54a4ebecafc2faa1
bbn.fn.getIdURL('my/location', {id: 1, test: 2});
```


```javascript
// my/other/location:59990af62ba3ebdd54a4ebecafc2faa1
bbn.fn.getIdURL('my/other/location', {id: 1, test: 2});
```


```javascript
// my/location:ec60cdf5001208a1fc5fbae05ac94a55
bbn.fn.getIdURL('my/location', {data: {a: 1, b: 2}});
```